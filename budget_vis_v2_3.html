<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syracuse Budget Cuts Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Barriecito&family=Finlandica&family=Frank+Ruhl+Libre:wght@300..900&family=Lora:ital,wght@0,400..700;1,400..700&family=Raleway:ital,wght@0,849;1,849&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* font-family: "Raleway", sans-serif;
  font-optical-sizing: auto;
  font-weight: 372;
  font-style: normal; */
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
            background-color: #f9f9f9;
        }

        h1,
        h2,
        h3 {
            color: #2C3E50;
            margin-top: 30px;
            font-family: "Lora", serif;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
        }

        h1 {
            border-bottom: 2px solid #3498DB;
            padding-bottom: 10px;
            text-align: center;
        }

        .chart-container {
            margin: 40px 0;
            padding: 20px;
            border-radius: 5px;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .explanation {
            background-color: #EBF5FB;
            border-left: 4px solid #3498DB;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }

        .tooltip {
            position: absolute;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 5px;
            pointer-events: none;
            font-size: 14px;
            max-width: 250px;
            z-index: 10;
        }

        svg {
            overflow: visible;
        }

        .axis text {
            font-size: 12px;
        }

        @media (max-width: 600px) {
            .axis text {
                font-size: 10px;
            }
        }

        .legend {
            font-size: 12px;
        }

        .intro {
            border-radius: 5px;
            background-color: #2C3E50;
            color: white;
            padding: 20px;
            margin-bottom: 30px;
        }

        .chart-title {
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
            color: #2C3E50;
            font-family: "Raleway", sans-serif;
            font-optical-sizing: auto;
            font-weight: 600;
            font-style: normal;
        }

        .chart-subtitle {
            text-align: center;
            font-size: 14px;
            margin-bottom: 20px;
            color: #7F8C8D;
        }

        button {
            background-color: #3498DB;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        button:hover {
            background-color: #2980B9;
        }

        .highlight {
            color: #E74C3C;
            font-weight: bold;
        }

        .footer {
            margin-top: 40px;
            text-align: center;
            font-size: 12px;
            color: #7F8C8D;
        }

        .intro h1 {
            color: white;
        }

        #budget-cuts-subtltle {
            margin-bottom: 175px;
        }
    </style>
</head>

<body>
    <div id="content">
        <div class="intro">
            <h1>Syracuse Budget Cuts 2025: Impact Analysis</h1>
            <p>This visualization explores the proposed budget amendments for Syracuse in 2025, highlighting departments
                facing significant cuts and their potential impact on city services.</p>
        </div>

        <!-- Chart 1: Percent Cut by Department -->
        <div class="chart-container">
            <div class="chart-title">Percentage of Budget Cuts by Department</div>
            <div class="chart-subtitle">Departments ordered by percentage of cuts (highest to lowest)</div>
            <div id="percent-cut-chart"></div>
        </div>

        <div class="explanation">
            <h3>Understanding the Budget Cut Percentages</h3>
            <p>This chart shows the percentage of budget cuts for each department. The Department of Assessment is
                facing the largest percentage cut at over 52%, followed by the Office of Gun Violence Prevention at
                nearly 38%. These drastic reductions could severely impair these departments' abilities to fulfill their
                missions, particularly in areas that directly affect public safety and property valuations.</p>
        </div>

        <!-- Chart 2: Absolute Cut Values -->
        <div class="chart-container">
            <div class="chart-title">Dollar Amount of Budget Cuts by Department</div>
            <div class="chart-subtitle" id="budget-cuts-subtltle">Showing the actual monetary impact of cuts</div>
            <div id="absolute-cut-chart"></div>
        </div>

        <div class="explanation">
            <h3>The Real Dollar Impact</h3>
            <p>While percentage cuts tell one story, the actual dollar amounts reveal another dimension. The Department
                of Assessment and Law Department are losing the most funding in absolute terms, with cuts of $1,000,000
                and $869,067 respectively. These substantial reductions will likely result in reduced staffing, fewer
                services, and potential delays in critical city functions.</p>
        </div>

        <!-- Chart 3: Before vs After Budget -->
        <div class="chart-container">
            <div class="chart-title">Proposed vs. Amended Budget Comparison</div>
            <div class="chart-subtitle">Compare original proposed budgets with post-amendment figures</div>
            <div id="before-after-chart"></div>
            <div style="text-align: center; margin-top: 10px;">
                <button id="sort-budget-btn">Sort by Budget Size</button>
                <button id="sort-cut-btn">Sort by Cut Percentage</button>
            </div>
        </div>

        <div class="explanation">
            <h3>Before vs. After: The Amended Budget Impact</h3>
            <p>This comparison highlights the stark differences between originally proposed budgets and the amended
                figures after cuts. The ability to sort by either budget size or cut percentage reveals patterns in how
                cuts were distributed. Notice how some smaller departments are taking proportionally larger hits, while
                some larger departments see significant dollar cuts that represent smaller percentages of their overall
                budgets.</p>
        </div>

        <!-- Chart 4: Cut Types Analysis -->
        <div class="chart-container">
            <div class="chart-title">Types of Budget Cuts by Category</div>
            <div class="chart-subtitle">Analyzing where cuts are being made within departments</div>
            <div id="cut-types-chart"></div>
        </div>

        <div class="explanation">
            <h3>Where Are The Cuts Coming From?</h3>
            <p>This analysis reveals concerning patterns in the types of cuts being implemented. Professional Services
                accounts for the largest portion of cuts, which could indicate reduced expert consultations and
                specialized assistance. Significant cuts to salaries suggest potential layoffs or unfilled positions,
                directly impacting service delivery. These patterns show how budget decisions may affect the quality and
                availability of city services.</p>
        </div>

        <div class="footer">
            <p>Data source: Syracuse Budget Amendments 2025</p>
            <p>Created with D3.js | Last updated: May 2025</p>
        </div>
    </div>

    <script>
        // Parse the CSV data
        const rawData = `Department_Broad,Department_Specific,Proposed_Budget,Account_Amend_1,Amt_Changed_1,Account_Ammend_2,Amt_Changed_2,Account_Ammend_3,Amt_Changed_3,Account_Ammend_4,Amt_Changed_4,Account_Ammend_5,Amt_Changed_5,Account_Amend_6,Amt_Changed_6,Account_Ammend_7,Amt_Changed_7,Account_Ammend_8,Amt_Changed_8,Account_Ammend_9,Amt_Changed_9,Account_Ammend_10,Amt_Changed_10,Amended_Budget,Difference,Change
Common Council,Common Council,"$801,988","10100 “Professional Services"" Account — 541500","-$56,140",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$745,848","-$56,140",-7.00%
Citizen Review Board,Citizen Review Board,"$414,844","10500 ""Professional Services"" Account — 541500","-$29,040",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$385,804","-$29,040",-7.00%
Executive,Office of the Mayor,"$1,055,244","12100 ""Contracted Services-Related Parties"" Account — 541700","-$73,866",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$981,378","-$73,866",-7.00%
Executive,Office of Gun Violence Prevention,"$395,540","12150 ""Professional Services"" Account — 541500","-$150,000",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$245,540","-$150,000",-37.92%
Executive,Office of Comunications,"$394,200","12120 ""Consumable Supplies & Materials"" Account — 540541","-$2,000","12120 “Technical Devices & Tools"" Account — 540542","-$6,200","12120 “Other Services"" Account — 540552","-$19,394",,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$366,606","-$27,594",-7.00%
Executive,"Office of Accountability, Performance & Innovation (API)","$4,281,745","12140 ""Factual & Informational” Account — 540530","-$649,723",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$3,632,022","-$649,723",-15.17%
Executive,Office of Management & Budget,"$523,182","13400 ""Salaries"" Account — 510100","-$25,923",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$497,259","-$25,923",-4.95%
Executive,Division of Purchase,"$130,278","13450 ""Office Supplies"" Account — 540320",-$500,"13450 ""Travel"" Account — 541610",-$500,"13450 ""Training"" Account — 541620",-$700,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$128,578","-$1,700",-1.30%
Executive,Division of Equity Compliance & Social Impact,"$200,852","64500 ""Office Supplies"" Account — 540320","-$1,000","64500 ""Travel"" Account — 541610","-$3,000","64500 ""Training"" Account — 541620","-$4,000","64500 ""Professional Development"" Account — 541630                                                                                                                                            ","-$1,000",,$0,,$0,,$0,,$0,,$0,,$0,"$191,852","-$9,000",-4.48%
Executive,Office of Personnel & Labor Relations,"$1,398,236","14300 ""Salaries"" Account — 510100","-$97,877",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$1,300,359","-$97,877",-7.00%
Executive,Bureau of Research,"$346,516","14800 ""Travel"" Account — 541610","-$4,185",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$342,331","-$4,185",-2.08%
Executive,Bureau of Information Technology,"$2,430,163","16800 ""Salaries"" Account — 510100","-$170,112","16800 ""Other Services"" Account — 540552","-$250,000","16800 ""Professional Services"" Account — 541500","-$250,000",,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$1,760,051","-$670,112",-27.57%
Finance,Bureau of Accounts,"$902,714","13110 ""Salaries"" Account — 510100","-$63,190",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$839,524","-$63,190",-31.46%
Finance,Parking Violatons Bureau,"$1,066,447","13310 ""Salaries"" Account — 510100","-$74,652",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$991,795","-$74,652",-7.00%
Audit,Office of the City Auditor,"$348,866","13200 ""Professional Services"" Account — 541500","-$24,421",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$324,445","-$24,421",-12.16%
City Clerk,City Clerk's Office,"$408,472",14100 Professional Services Account — 541500,"-$15,000",,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$393,472","-$15,000",-3.67%
Assessment,Department of Assessment,"$1,918,192","13550 ""Professional Services"" Account — 541500","-$1,000,000",,$0,,0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$918,192","-$1,000,000",-52.13%
Assessment,Board of Assessment Review,"$20,200","13560 ""Salaries"" Account — 510100","-$1,414",,$0,,0,,$0,,$0,,$0,,$0,,$0,,$0,,$0,"$18,786","-$1,414",-7.00%
Board of Zoning Appeals,Board of Zoning Appeal,"$9,500","80100 “Temporary Services-P/T"" Account — 510300",-$655,,0,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$8,845",-$655,-6.89%
Department of Law,Law Department,"$5,272,377","14200 ""Professional Services"" Account — 541500","-$869,067",,0,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$4,403,310","-$869,067",-16.48%
Department of Law,Bureau of Administrative Adjudication,"$966,533","13320 “Temporary Services-P/T"" Account — 510300","-$67,658",,0,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$898,875","-$67,658",-7.00%
Neighborhood & Business Development,Neighborhood & Business Development,1389055,"64200 ""Contracted Services-Related Parties"" Account — 541700","-$97,234",,0,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$1,291,821","-$97,234",-7.00%
Neighborhood & Business Development,Division of Code Enforcement,6385952,"36210 ""Professional Services"" Account — 541500",-250000,"36210 ""Contracted Services-Related Parties"" Account — 541700",-210000,36210 Salaries Account — 510100,-120000,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$5,805,952","-$580,000",-9.08%
Neighborhood & Business Development,Division of Planning & Sustainability,417998,"64210 ""Professional Services"" Account — 541500",-29260,,0,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$388,738","-$29,260",-7.00%
Engineering,Department of Engineering,1575842,"80400 ""Salaries"" Account — 510100",-110309,,0,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$1,465,533","-$110,309",-7.00%
Department of Public Works,DPW Environmental Services,1319805,"14910 “Overtine Wages"" Account — 510400",-43537,"14910 ""Temporary Services-P/T"" Account — 510300",-49000,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$1,227,268","-$92,537",-7.01%
Department of Public Works,DPW Building Services,4357453,16210 Wages- F/T Weekly Account — 510200,-305022,16210 Wages- F/T Weekly Account — 510200,-305022,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$3,747,409","-$610,044",-14.00%
Department of Public Works,DPW Street Repair,"1,412,569","51200 ""Salaries"" Account — 510100",-98880,,0,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$1,313,689","-$98,880",-7.00%
Department of Public Works,DPW Motor Equipment Maintenance,"7,444,970","51320 ""Fuels"" Account — 540110",-521148,"51320 ""Automotive Repairs"" Account — 540210",-500000,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$6,423,822","-$1,021,148",-13.72%
Department of Public Works,DPW Snow & Ice Control,"4,629,877","51420 “Consumable Supplies & Materials"" Account — 540541",-324092,,0,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$4,305,785","-$324,092",-7.00%
Department of Public Works,"DPW Waste Collection, Recycling & Disposal","8,583,907","81600 “Other Services"" Account — 540552","-600,874",,0,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$7,983,033","-$600,874",-7.00%
Department of Public Works,DPW Street Cleaning,"1,643,949","81700 ""Manual Services"" Account — 540551",-70000,"81700 ""Other Services"" Account ~ 540552",-45077,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$1,528,872","-$115,077",-7.00%
Department of Public Works,DPW Transportation,"9,152,687","81800 ""Professional Services"" Account — 541500","-1,140,689",,0,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$8,011,998","-$1,140,689",-12.46%
Police Department,Police Field Services - Sworn,"57,697,300","31230 ""Factual & Informational” Account — 540530",-1000000,"31230 ""Overtime Wages"" Account — 510400",-1000000,"31230 “Professional Services"" Account — 541500",-884865,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$54,812,435","-$2,884,865",-5.00%
Police Department,Police Field Services - Civilian,"8,075,863","31231 ""Temporary Services-P/T"" Account — 510300","-415,000","31231 ""Salaries” Account — 510100",-239000,,0,,0,,$0,,$0,,$0,,$0,,$0,,$0,"$7,421,863","-$654,000",-8.10%
Fire Department,Fire Main - Sworn,"47,628,834","34100 ""Overtime Wages"" Account -— 510400",-1000000,"34100 ""Other Services"" Account — 540552",-136000,"34100 “Manual Services"" Account — 540551",-4000,"34100 ""Consumable Supplies & Materials"" Account — 540541",-50000,"34100 ""Factual & informational"" Account — 540530",-25000,"34100 ""Facility Repair” Account — 540511","-$225,000","34100 ""Technical Devices & Tools"" Account — 540542","-$300,000","34100 ""Emergency, Medical & Safety Supplies"" Account — 540520","-$260,000","34100 ""Professional Services"" Account — 541500","-$330,000","34100 ""Motor Equipment Repair Supplies"" Account — 540220","-$42,500","$45,256,334","-$2,372,500",-4.98%
Fire Department,Fire Main - Civilian,"1,337,059","34101 ""Salaries"" Account — 510100",-67000,,0,,0,,0,,0,,0,,0,,0,,0,,0,"$1,270,059","-$67,000",-5.01%
"Parks, Recreation & Youth Programs",Parks Administration,"837,816","70200 ""Salaries"" Account — 510100","-58,648",,0,,0,,0,,0,,0,,0,,0,,0,,0,"$779,168","-$58,648",-7.00%
"Parks, Recreation & Youth Programs",Parks Grounds Maintenance,"6,903,824","71100 ""Contracted Services-Related Parties"" Account — 541700",-74360,"71100 ""Manual Services"" Account — 540551",-408640,,0,,0,,0,,0,,0,,0,,0,,0,"$6,420,824","-$483,000",-7.00%
"Parks, Recreation & Youth Programs",Parks Recreation,"4,813,911","71400 ""Salaries"" Account — 510100",-165000,"71400 ""Temporary Services-P/T"" Account — 510300,",-165000,,0,,0,,0,,0,,0,,0,,0,,0,"$4,483,911","-$330,000",-6.86%
"Parks, Recreation & Youth Programs",Dog Control Division,530912,35100 “Salaries” Account — 510100,"-37,164",,0,,0,,0,,0,,0,,0,,0,,0,,0,"$493,748","-$37,164",-7.00%
Special Objects of Expense,Special Objects of Expense,1000000,"90000 — ""Housing Trust"" Account — 593007",-1000000,,0,,0,,0,,0,,0,,0,,0,,0,,0,$0,"-$1,000,000",-100.00%
Special Objects of Expense,Special Objects of Expense,250000,"90000 — “Home HeadQuarters"" Account — 595946",1000000,,0,,0,,0,,0,,0,,0,,0,,0,,0,"$1,250,000","$1,000,000",400.00%
Revenue Changes,Water Fund Revenue,"28,625,846",“Surpluses and Balances - Fund Balance”,"520,000",“Sale of Water’ Account - 421400,-520000,,0,,0,,0,,0,,0,,0,,0,,0,"$28,625,846",$0,0.00%
Revenue Changes,General Fund Revenue,"27,194,047",“Surpluses and Balances - Fund Balance”,"-12,800,238",,0,,0,,0,,0,,0,,0,,0,,0,,0,"$14,393,809","-$12,800,238",-47.07%
Revenue Changes,General Fund Revenue,"60,899,463",“Tax Levy”,"-2,513,138",,0,,0,,0,,0,,0,,0,,0,,0,,0,"$58,386,325","-$2,513,138",-4.13%
Revenue Changes,General Fund Revenue,"608,995",“1% Added Pursuant to Law”,"-25,131",,0,,0,,0,,0,,0,,0,,0,,0,,0,"$583,864","-$25,131",-4.13%
Syracuse School City District,Syracuse School City District,"612,456,627",Miscellaneous Revenue,"-1,455,000",Technical Adjustment - Salaries and Benefits,"1,422,179",Technical Adjustment - Supplies and Equipment,"-303,569",Technical Adjustment - Professional Services,406390,Technical Adjustment — Interfund and All Other Expenses,-3000000,,0,,0,,0,,0,,0,"$609,526,627","-$2,930,000",-0.48%`;

        // Helper functions for data parsing
        function cleanNumber(str) {
            if (!str) return 0;
            if (typeof str === 'number') return str;
            return parseFloat(str.replace(/[$,\s%]/g, ''));
        }

        // Parse the CSV data
        const parsedData = [];
        rawData.split('\n').forEach((row, index) => {
            if (index === 0) return; // Skip header

            const cells = [];
            let currentCell = '';
            let insideQuotes = false;

            // Parse CSV considering quoted commas
            for (let i = 0; i < row.length; i++) {
                if (row[i] === '"') {
                    insideQuotes = !insideQuotes;
                } else if (row[i] === ',' && !insideQuotes) {
                    cells.push(currentCell.trim());
                    currentCell = '';
                } else {
                    currentCell += row[i];
                }
            }
            cells.push(currentCell.trim());

            // Fix any missing values and calculate if needed
            const proposedBudget = cleanNumber(cells[2]);
            const amendedBudget = cleanNumber(cells[23]);
            let change = cleanNumber(cells[25]);

            // Some entries have #VALUE! for percent cut, recalculate those
            if (isNaN(change)) {
                change = ((amendedBudget - proposedBudget) / proposedBudget * 100);
            }

            const item = {
                departmentBroad: cells[0].replace(/"/g, ''),
                departmentSpecific: cells[1].replace(/"/g, ''),
                proposedBudget: proposedBudget,
                amendedBudget: amendedBudget,
                absoluteCut: proposedBudget - amendedBudget,
                change: change,
                accountAmmend1: cells[3],
                amtChanged1: cleanNumber(cells[4]),
                accountAmmend2: cells[5],
                amtChanged2: cleanNumber(cells[6]),
                accountAmmend3: cells[7],
                amtChanged3: cleanNumber(cells[8]),
                accountAmmend4: cells[9],
                amtChanged4: cleanNumber(cells[10]),
                accountAmmend5: cells[11],
                amtChanged5: cleanNumber(cells[12]),
                accountAmmend6: cells[13],
                amtChanged6: cleanNumber(cells[14]),
                accountAmmend7: cells[15],
                amtChanged7: cleanNumber(cells[16]),
                accountAmmend8: cells[17],
                amtChanged8: cleanNumber(cells[18]),
                accountAmmend9: cells[19],
                amtChanged9: cleanNumber(cells[20]),
                accountAmmend10: cells[21],
                amtChanged10: cleanNumber(cells[22]),
            };

            parsedData.push(item);
        });

        // Create tooltip
        const tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // Create a color scale for departments
        const colorScale = d3.scaleOrdinal()
            .domain(parsedData.map(d => d.departmentBroad))
            .range(d3.schemeCategory10);

        // Chart 1: Percent Cut by Department
        function createPercentChangeChart() {
            const sortedData = [...parsedData].sort((a, b) => b.change - a.change);

            const margin = { top: 30, right: 20, bottom: 120, left: 60 };
            const width = Math.min(800, window.innerWidth - 40) - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            const svg = d3.select("#percent-cut-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Create scales
            const x = d3.scaleBand()
                .domain(sortedData.map(d => d.departmentBroad))
                .range([0, width])
                .padding(0.2);

            const y = d3.scaleLinear()
                .domain([0, d3.max(sortedData, d => Math.abs(d.change)) * 1.1])
                .range([height, 0]);

            // Create axes
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em");

            svg.append("g")
                .call(d3.axisLeft(y).tickFormat(d => `${d}%`));

            // Create bars
            const bars = svg.selectAll(".bar")
                .data(sortedData)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.departmentBroad))
                .attr("width", x.bandwidth())
                .attr("y", height)
                .attr("height", 0)
                .attr("fill", (d, i) => {
                    // Color gradient based on severity of cuts
                    if (d.change > 30) return "#c0392b";
                    if (d.change > 15) return "#e74c3c";
                    if (d.change > 10) return "#f39c12";
                    if (d.change > 5) return "#f1c40f";
                    return "#27ae60";
                });

            // Animation
            bars.transition()
                .duration(1000)
                .delay((d, i) => i * 50)
                .attr("y", d => y(Math.abs(d.change)))
                .attr("height", d => height - y(Math.abs(d.change)));

            // Add labels
            svg.selectAll(".label")
                .data(sortedData)
                .enter()
                .append("text")
                .attr("class", "label")
                .attr("x", d => x(d.departmentBroad) + x.bandwidth() / 2)
                .attr("y", d => y(Math.abs(d.change)) - 5)
                .attr("text-anchor", "middle")
                .style("font-size", "11px")
                .style("opacity", 0)
                .text(d => `${Math.abs(d.change).toFixed(1)}%`)
                .transition()
                .duration(1000)
                .delay((d, i) => 1000 + i * 50)
                .style("opacity", 1);

            // Add tooltip functionality

            bars.on("mouseover", function (event, d) {
                d3.select(this).transition()
                    .duration(200)
                    .attr("opacity", 0.8);

                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);

                tooltip.html(`
                    <strong>${d.departmentBroad}</strong><br>
                    Proposed Budget: $${d3.format(",")(Math.round(d.proposedBudget))}<br>
                    Amended Budget: $${d3.format(",")(Math.round(d.amendedBudget))}<br>
                    Percent Cut: ${Math.abs(d.change).toFixed(2)}% ($${d3.format(",")(Math.round(d.absoluteCut))})
                `)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
                .on("mouseout", function () {
                    d3.select(this).transition()
                        .duration(500)
                        .attr("opacity", 1);

                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            // Add title
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", -10)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .text("Budget Cut Percentages by Department");

            // Add y-axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin.left + 15)
                .attr("x", -height / 2)
                .attr("text-anchor", "middle")
                .text("Percentage Cut");
        }

        // Chart 2: Absolute Cut Values

function createAbsoluteCutChart() {
    const filteredData = parsedData.filter(d => d.departmentBroad !== "Revenue Changes");

    // Group data by departmentBroad and then departmentSpecific
    const nestedData = d3.groups(filteredData, d => d.departmentBroad, d => d.departmentSpecific)
        .map(([departmentBroad, deptSpecificGroups]) => {
            const parts = deptSpecificGroups.map(([departmentSpecific, entries]) => {
                return {
                    departmentSpecific,
                    departmentBroad,
                    absoluteCut: d3.sum(entries, d => d.absoluteCut),
                    entries: entries
                };
            }).sort((a, b) => b.absoluteCut - a.absoluteCut);

            return {
                departmentBroad,
                parts,
                totalCut: d3.sum(parts, d => d.absoluteCut)
            };
        })
        .sort((a, b) => b.totalCut - a.totalCut)
        .slice(0, 15); // Top 15 departmentBroad

    const margin = { top: 30, right: 20, bottom: 120, left: 80 };
    const width = Math.min(800, window.innerWidth - 40) - margin.left - margin.right;
    const height = 500 - margin.top - margin.bottom;

    const svg = d3.select("#absolute-cut-chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    const x = d3.scaleBand()
        .domain(nestedData.map(d => d.departmentBroad))
        .range([0, width])
        .padding(0.2);

    const y = d3.scaleLinear()
        .domain([0, d3.max(nestedData, d => d.totalCut) * 1.1])
        .range([height, 0]); // Inverted

    // X-axis
    svg.append("g")
    .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(x))
        .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end")
        .style("font-size", "1.5em")
        .attr("dx", "0em")
        .attr("dy", "0.5em");

    // Y-axis
    svg.append("g")
        .call(d3.axisLeft(y)
            .tickFormat(d => `$${d3.format(".3s")(d).replace("M", " Million")}`));

    // Bars with stacking
    nestedData.forEach(dept => {
        let yOffset = 0;

        dept.parts.forEach(part => {
            svg.append("rect")
                .attr("x", x(dept.departmentBroad))
                .attr("y", y(yOffset + part.absoluteCut))
                .attr("width", x.bandwidth())
                .attr("height", y(yOffset) - y(yOffset + part.absoluteCut))
                .attr("fill", "#F24932")
                .attr("stroke", "black")
                .attr("stroke-width", 1)
                .append("title")
                // .text(`${part.departmentBroad} - ${part.departmentSpecific}\nCut: $${d3.format(",")(part.absoluteCut)}`);

            yOffset += part.absoluteCut;
        });
    });

    // Labels showing total cut amount at bottom of each bar
    svg.selectAll(".label")
        .data(nestedData)
        .enter()
        .append("text")
        .attr("class", "label")
        .attr("x", d => x(d.departmentBroad) + x.bandwidth() / 2)
        // .attr("y", d => y(d.totalCut) + 500)
        .attr("y", d => y(d.totalCut) - 5)
        .attr("text-anchor", "middle")
        .style("font-size", "15px")
        .style("fill", "#F24932")
        .style("opacity", 0)
        .text(d => `$${d3.format(".2s")(d.totalCut)}`)
        .transition()
        .duration(1000)
        .delay((d, i) => 1000 + i * 50)
        .style("opacity", 1);
        // .text(`${part.departmentBroad} - ${part.departmentSpecific}\nCut: $${d3.format(",")(part.absoluteCut)}`);

            // Tooltip (unchanged)
            nestedData.on("mouseover", function (event, d) {
                d3.select(this).transition()
                    .duration(200)
                    .attr("opacity", 0.8);

                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);

        //         tooltip.html(`
        //     <strong>${d.departmentBroad}</strong><br>
        //     Original Budget: $${d3.format(",")(Math.round(d.proposedBudget))}<br>
        //     Total Cut: $${d3.format(",")(Math.round(d.absoluteCut))}<br>
        //     Percentage Cut: ${Math.abs(d.change).toFixed(2)}%<br>
        //     Areas Cut: ${d.accountAmmend1 + ' ' + d.accountAmmend2}<br>

        // `)
tooltip.html(() => {
    const amendments = [];

    for (let i = 1; i <= 10; i++) {
        const acct = d[`accountAmmend${i}`];
        const amt = d[`amtChanged${i}`];

        if (acct && amt !== 0 && !isNaN(amt)) {
            amendments.push({ account: acct, amount: amt });
        }
    }

    const tableRows = amendments.map(a =>
        `<tr>
            <td style="padding: 2px 8px; text-align: left; border: 1px solid white">${a.account}</td>
            <td style="padding: 2px 8px; text-align: right; border: 1px solid white">$${d3.format(",")(a.amount)}</td>
        </tr>`
    ).join("");

    return `
        <strong>${d.departmentBroad}</strong><br>
        Original Budget: $${d3.format(",")(Math.round(d.proposedBudget))}<br>
        Total Cut: $${d3.format(",")(Math.round(d.absoluteCut))}<br>
        Percentage Cut: ${Math.abs(d.change).toFixed(2)}%<br>
        <br>
        <table style="border-collapse: collapse; border: 1px solid white">
            <thead>
                <tr>
                    <th style="text-align: left; padding-right: 10px; border: 1px solid white">Account Amended</th>
                    <th style="text-align: right; border: 1px solid white">Amount Changed</th>
                </tr>
            </thead>
            <tbody>
                ${tableRows}
            </tbody>
        </table>
    `;
})


                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
                .on("mouseout", function () {
                    d3.select(this).transition()
                        .duration(500)
                        .attr("opacity", 1);

                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

}

        // Chart 3: Before vs After Budget
        function createBeforeAfterChart() {
            let sortedData = [...parsedData].sort((a, b) => b.proposedBudget - a.proposedBudget);

            const margin = { top: 30, right: 120, bottom: 120, left: 80 };
            const width = Math.min(800, window.innerWidth - 40) - margin.left - margin.right;
            const height = 600 - margin.top - margin.bottom;

            const svg = d3.select("#before-after-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Create scales
            const y = d3.scaleBand()
                .domain(sortedData.map(d => d.departmentBroad))
                .range([0, height])
                .padding(0.2);

            const x = d3.scaleLinear()
                .domain([0, d3.max(sortedData, d => d.proposedBudget) * 1.1])
                .range([0, width]);

            // Create axes
            svg.append("g")
                .call(d3.axisLeft(y));

            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).tickFormat(d => `$${d3.format(".2s")(d)}`));

            // Create grouped bars for before/after
            const beforeBars = svg.selectAll(".before-bar")
                .data(sortedData)
                .enter()
                .append("rect")
                .attr("class", "before-bar")
                .attr("y", d => y(d.departmentBroad))
                .attr("height", y.bandwidth())
                .attr("x", 0)
                .attr("width", 0)
                .attr("fill", "#3498db")
                .attr("opacity", 0.8);

            const afterBars = svg.selectAll(".after-bar")
                .data(sortedData)
                .enter()
                .append("rect")
                .attr("class", "after-bar")
                .attr("y", d => y(d.departmentBroad) + y.bandwidth() / 4)
                .attr("height", y.bandwidth() / 2)
                .attr("x", 0)
                .attr("width", 0)
                .attr("fill", "#e74c3c");

            // Animation
            beforeBars.transition()
                .duration(1000)
                .delay((d, i) => i * 30)
                .attr("width", d => x(d.proposedBudget));

            afterBars.transition()
                .duration(1000)
                .delay((d, i) => i * 30 + 500)
                .attr("width", d => x(d.amendedBudget));

            // Add legend
            const legend = svg.append("g")
                .attr("class", "legend")
                .attr("transform", `translate(${width + 10}, 0)`);

            legend.append("rect")
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", 18)
                .attr("height", 18)
                .attr("fill", "#3498db");

            legend.append("text")
                .attr("x", 24)
                .attr("y", 9)
                .attr("dy", ".35em")
                .text("Proposed Budget");

            legend.append("rect")
                .attr("x", 0)
                .attr("y", 24)
                .attr("width", 18)
                .attr("height", 18)
                .attr("fill", "#e74c3c");

            legend.append("text")
                .attr("x", 24)
                .attr("y", 33)
                .attr("dy", ".35em")
                .text("Amended Budget");

            // Add tooltip functionality
            beforeBars.on("mouseover", function (event, d) {
                d3.select(this).transition()
                    .duration(200)
                    .attr("opacity", 1);

                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);

                tooltip.html(`
                    <strong>${d.departmentBroad}</strong><br>
                    Proposed Budget: ${d3.format(",")(Math.round(d.proposedBudget))}<br>
                    Cut Amount: ${d3.format(",")(Math.round(d.absoluteCut))}<br>
                    Cut Percentage: ${Math.abs(d.change).toFixed(2)}%
                `)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
                .on("mouseout", function () {
                    d3.select(this).transition()
                        .duration(500)
                        .attr("opacity", 0.8);

                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            afterBars.on("mouseover", function (event, d) {
                d3.select(this).transition()
                    .duration(200)
                    .attr("opacity", 0.8);

                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);

                tooltip.html(`
                    <strong>${d.departmentBroad}</strong><br>
                    Amended Budget: ${d3.format(",")(Math.round(d.amendedBudget))}<br>
                    Cut Amount: ${d3.format(",")(Math.round(d.absoluteCut))}<br>
                    Cut Percentage: ${Math.abs(d.change).toFixed(2)}%
                `)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
                .on("mouseout", function () {
                    d3.select(this).transition()
                        .duration(500)
                        .attr("opacity", 1);

                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            // Add title
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", -10)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .text("Proposed vs. Amended Budget by Department");

            // Add x-axis label
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", height + 40)
                .attr("text-anchor", "middle")
                .text("Budget Amount ($)");

            // Add sorting functionality
            d3.select("#sort-budget-btn").on("click", function () {
                sortedData = [...parsedData].sort((a, b) => b.proposedBudget - a.proposedBudget);
                updateChart();
            });

            d3.select("#sort-cut-btn").on("click", function () {
                sortedData = [...parsedData].sort((a, b) => b.change - a.change);
                updateChart();
            });

            function updateChart() {
                // Update y domain
                y.domain(sortedData.map(d => d.departmentBroad));

                // Update y-axis with transition
                svg.select(".y-axis")
                    .transition()
                    .duration(750)
                    .call(d3.axisLeft(y));

                // Update bars
                beforeBars.data(sortedData)
                    .transition()
                    .duration(750)
                    .attr("y", d => y(d.departmentBroad))
                    .attr("width", d => x(d.proposedBudget));

                afterBars.data(sortedData)
                    .transition()
                    .duration(750)
                    .attr("y", d => y(d.departmentBroad) + y.bandwidth() / 4)
                    .attr("width", d => x(d.amendedBudget));
            }

            // Create y-axis with class for updates
            svg.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(y));
        }

        // Chart 4: Cut Types Analysis
        function createCutTypesChart() {
            // Analyze cuts by category
            const categoryMap = new Map();

            // Process all account amendments to categorize cuts
            parsedData.forEach(dept => {
                // Process account 1
                if (dept.accountAmmend1) {
                    const accountType = extractAccountType(dept.accountAmmend1);
                    if (categoryMap.has(accountType)) {
                        categoryMap.set(accountType, categoryMap.get(accountType) + Math.abs(dept.amtChanged1));
                    } else {
                        categoryMap.set(accountType, Math.abs(dept.amtChanged1));
                    }
                }

                // Process account 2
                if (dept.accountAmmend2 && dept.amtChanged2 !== 0) {
                    const accountType = extractAccountType(dept.accountAmmend2);
                    if (categoryMap.has(accountType)) {
                        categoryMap.set(accountType, categoryMap.get(accountType) + Math.abs(dept.amtChanged2));
                    } else {
                        categoryMap.set(accountType, Math.abs(dept.amtChanged2));
                    }
                }

                // Process account 3
                if (dept.accountAmmend3 && dept.amtChanged3 !== 0) {
                    const accountType = extractAccountType(dept.accountAmmend3);
                    if (categoryMap.has(accountType)) {
                        categoryMap.set(accountType, categoryMap.get(accountType) + Math.abs(dept.amtChanged3));
                    } else {
                        categoryMap.set(accountType, Math.abs(dept.amtChanged3));
                    }
                }
            });

            // Convert map to array for D3
            const cutTypeData = Array.from(categoryMap, ([key, value]) => ({
                category: key,
                amount: value
            })).sort((a, b) => b.amount - a.amount);

            // Define dimensions for pie chart
            const width = Math.min(500, window.innerWidth - 40);
            const height = 400;
            const radius = Math.min(width, height) / 2;

            // Create SVG
            const svg = d3.select("#cut-types-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width / 2},${height / 2})`);

            // Create color scale
            const color = d3.scaleOrdinal()
                .domain(cutTypeData.map(d => d.category))
                .range(["#2c3e50", "#3498db", "#9b59b6", "#e74c3c", "#f1c40f", "#16a085", "#2ecc71", "#e67e22", "#1abc9c", "#95a5a6"]);

            // Create pie chart
            const pie = d3.pie()
                .value(d => d.amount)
                .sort(null);

            const data_ready = pie(cutTypeData);

            // Create arc generator
            const arc = d3.arc()
                .innerRadius(radius * 0.4)
                .outerRadius(radius * 0.8);

            const outerArc = d3.arc()
                .innerRadius(radius * 0.9)
                .outerRadius(radius * 0.9);

            // Build the pie chart with animation
            const slices = svg.selectAll('path')
                .data(data_ready)
                .enter()
                .append('path')
                .attr('d', arc)
                .attr('fill', d => color(d.data.category))
                .attr("stroke", "white")
                .style("stroke-width", "2px")
                .style("opacity", 0.7)
                .on("mouseover", function (event, d) {
                    d3.select(this)
                        .style("opacity", 1);

                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);

                    const percentage = (d.data.amount / d3.sum(cutTypeData, d => d.amount) * 100).toFixed(1);

                    tooltip.html(`
                        <strong>${d.data.category}</strong><br>
                        Amount: ${d3.format(",")(Math.round(d.data.amount))}<br>
                        Percentage: ${percentage}% of total cuts
                    `)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function () {
                    d3.select(this)
                        .style("opacity", 0.7);

                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            // Animation
            slices
                .transition()
                .duration(1000)
                .attrTween('d', function (d) {
                    const i = d3.interpolate({ startAngle: 0, endAngle: 0 }, d);
                    return function (t) { return arc(i(t)); };
                });

            // Add polylines for labels
            const polylines = svg.selectAll('polyline')
                .data(data_ready)
                .enter()
                .append('polyline')
                .style("fill", "none")
                .style("stroke", "black")
                .style("opacity", 0.3)
                .style("stroke-width", "1px")
                .attr('points', function (d) {
                    const pos = outerArc.centroid(d);
                    pos[0] = radius * 0.95 * (midAngle(d) < Math.PI ? 1 : -1);
                    return [arc.centroid(d), outerArc.centroid(d), pos];
                });

            // Add labels with animation
            const labels = svg.selectAll('text')
                .data(data_ready)
                .enter()
                .append('text')
                .style("opacity", 0)
                .text(d => {
                    const percentage = (d.data.amount / d3.sum(cutTypeData, d => d.amount) * 100).toFixed(1);
                    return `${d.data.category} (${percentage}%)`;
                })
                .attr('transform', function (d) {
                    const pos = outerArc.centroid(d);
                    pos[0] = radius * 0.99 * (midAngle(d) < Math.PI ? 1 : -1);
                    return `translate(${pos})`;
                })
                .style('text-anchor', function (d) {
                    return midAngle(d) < Math.PI ? 'start' : 'end';
                })
                .style("font-size", "12px");

            labels.transition()
                .delay(1000)
                .duration(500)
                .style("opacity", function (d) {
                    // Only show labels for larger slices to avoid overlap
                    const percentage = d.data.amount / d3.sum(cutTypeData, d => d.amount) * 100;
                    return percentage > 5 ? 1 : 0;
                });

            // Add title
            svg.append("text")
                .attr("x", 0)
                .attr("y", -height / 2 + 20)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .text("Distribution of Budget Cuts by Category");

            // Helper function for middle angle
            function midAngle(d) {
                return d.startAngle + (d.endAngle - d.startAngle) / 2;
            }

            // Helper function to extract account type from account string
            function extractAccountType(accountStr) {
                if (!accountStr) return "Other";

                accountStr = accountStr.toString();

                if (accountStr.includes("Professional Services")) {
                    return "Professional Services";
                } else if (accountStr.includes("Salaries") || accountStr.includes("Wages")) {
                    return "Salaries & Wages";
                } else if (accountStr.includes("Temporary Services") || accountStr.includes("Overtime")) {
                    return "Temporary & Overtime";
                } else if (accountStr.includes("Contracted Services")) {
                    return "Contracted Services";
                } else if (accountStr.includes("Office Supplies") || accountStr.includes("Supplies & Materials")) {
                    return "Supplies & Materials";
                } else if (accountStr.includes("Travel")) {
                    return "Travel";
                } else if (accountStr.includes("Training") || accountStr.includes("Development")) {
                    return "Training & Development";
                } else if (accountStr.includes("Other Services")) {
                    return "Other Services";
                } else if (accountStr.includes("Technical") || accountStr.includes("Tools")) {
                    return "Technical Equipment";
                } else if (accountStr.includes("Factual & Informational")) {
                    return "Information Services";
                } else {
                    return "Other";
                }
            }
        }

        // Execute all chart creation functions
        window.addEventListener('load', function () {
            createPercentChangeChart();
            createAbsoluteCutChart();
            createBeforeAfterChart();
            createCutTypesChart();
        });
    </script>
</body>

</html>